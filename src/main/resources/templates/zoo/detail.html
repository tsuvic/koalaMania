<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
<link rel="canonical"
	href="https://getbootstrap.jp/docs/5.0/examples/starter-template/">
<!-- Bootstrap core CSS -->
<link
	href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css
	rel="stylesheet"
	integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
	crossorigin="anonymous">



<!-- Custom styles for this template -->
<link href="/css/starter-template.css" rel="stylesheet"></link>
<script type="text/javascript">
	$(function() {
		$('.deletePost').click(function(e) {
			const deleteImageFalg = confirm('この投稿を削除してもよろしいですか？');
			if (deleteImageFalg) {
				const post_id = $(this).next().val();
				const zoo_id = $(this).next().next().val();
				const csrf = $(this).next().next().next().val();
				$('<form/>', {action: '/post/delete', method: 'post'})
				  .append($('<input/>', {type: 'hidden', name: 'post_id', value: post_id}))
				  .append($('<input/>', {type: 'hidden', name: 'zoo_id', value: zoo_id}))
				  .append($('<input/>', {type: 'hidden', name: '_csrf', value: csrf}))
				  .appendTo(document.body)
				  .submit();
			}
		});
		
	});
</script>
<title th:text="${title}"></title>
</head>

<body>
	<div th:replace="~{block/header_boot::headerA_boot}"></div>
	<div th:object="${zoo}">
		<button class="btn btn-primary btn-sm" type="button"
			th:onclick="'location.href = \'' +@{/post/{zoo_id}(zoo_id=*{zoo_id})} + '\''">投稿する</button>
		<table class="table table-hover table-responsive">
			<tr>
				<th class="cell_title">名前</th>
				<td th:text="*{zoo_name}"></td>
			</tr>
			<tr>
				<th class="cell_title">所在地</th>
				<td th:text="*{prefecture.name}"></td>
			</tr>
			<tr>
				<th class="cell_title">投稿</th>
				<td><div th:each="post : ${postList}" th:object="${post}"
						style="margin: 10px; border: solid;">
						<div style="margin: 10px;">
							<a
								th:href="@{/user/mypage/{user_id}(user_id=*{loginUser.user_id})}"><img
								th:src="*{loginUser.profileImagePath}" width="40px"
								height="40px"></a> <a
								th:href="@{/user/mypage/{user_id}(user_id=*{loginUser.user_id})}"
								th:text="*{loginUser.userName}"> </a> <span
								th:text="*{displayDiffTime}"></span>	
							<button sec:authorize="isAuthenticated()" class="btn btn-danger btn-sm deletePost" th:if ="*{loginUser.user_id} == ${#authentication.principal.user_id}" type="button">
							この投稿を削除</button>
							<input sec:authorize="isAuthenticated()" th:if ="*{loginUser.user_id} == ${#authentication.principal.user_id}" type = "hidden" name = "post_id" th:value = "*{post_id}">
							<input sec:authorize="isAuthenticated()" th:if ="*{loginUser.user_id} == ${#authentication.principal.user_id}" type = "hidden" name = "zoo_id" th:value = "${zoo.zoo_id}">
							<input sec:authorize="isAuthenticated()" th:if ="*{loginUser.user_id} == ${#authentication.principal.user_id}" type = "hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
						</div>
						<div
							th:unless="*{#dates.format(visitDate,'yyyy年M月d日')} == '9999年1月1日'"
							th:text="'訪問日:  ' + *{#dates.format(visitDate,'yyyy年M月d日')}"
							style="margin: 10px;"></div>
						<div
							th:if="*{#dates.format(visitDate,'yyyy年M月d日')} == '9999年1月1日'"
							th:text="'訪問日:  指定なし'" style="margin: 10px;"></div>
						<a th:href="@{/post/postDetail/{post_id}(post_id=*{post_id})}"
							style="text-decoration: none; color: black;">
							<div th:text="*{contents}"
								style="white-space: pre-wrap; margin: 10px;"></div>
						</a>
						<div style="margin: 10px;">
							<span th:each="postImage : *{postImageList}"
								th:object="${postImage}"
								style="display: inline-block; margin: 10px;"> <a
								th:unless="*{animal} == null"
								th:href="@{/detail/{animal_id}(animal_id=*{animal.animal_id})}"
								th:text="'#' + *{animal.name}"></a><br
								th:unless="*{animal} == null"> <a
								th:href="@{/post/postDetail/{post_id}(post_id=*{post.post_id})}"
								style="text-decoration: none; color: black;"> <img
									th:src="*{imageAddress}" width="100px" height="100px"
									style="border: solid;">
							</a>
							</span>
						</div>
						<a th:href="@{/post/postDetail/{post_id}(post_id=*{post_id})}">
						<div th:text="*{childrenCount}+'件のコメント'"></div>
						</a>
					</div>
				</td>
			</tr>
		</table>
	</div>
</body>
</html>